<a href="/invoices">Return to Invoices</a>
<h3><%= invoiceId?'Edit':'New' %> Invoice</h3>
<form
  id="invoice-form"
  action="/invoices/edit/<%= invoiceId??''%>"
  method="POST"
>
  <label for="invoiceNumber">Invoice Number:</label>
  <input
    id="invoice-number"
    name="invoiceNumber"
    type="string"
    value="<%=invoice.invoiceNumber ?
  invoice.invoiceNumber : '' %>"
  />
  <label for="invoiceDate">Invoice Date:</label>
  <input
    id="invoice-date"
    name="invoiceDate"
    type="date"
    value="<%=invoice.invoiceDate ? invoice.invoiceDate: '' %>"
  />
  <label for="dueDate">Due Date:</label>
  <input
    id="due-date"
    name="dueDate"
    type="date"
    value="<%=invoice.dueDate ? invoice.dueDate.toISOString() : '' %>"
  />
  <label for="clientId">Client:</label>
  <select name="clientId">
    <option value="">Select a client</option>
    <% for (let i=0; i < clientList.length; i++) { %>
    <option value="<%=clientList[i]._id %>" <%=invoice.invoiceClient && clientList[i]._id.equals(invoice.invoiceClient._id) && 'selected' %>
      > <%= clientList[i].name%>
    </option>
    <%} %>
  </select>

  <% for (let i=0; i < invoice.products.length; i++) { %>
      <label for="<%= invoice['products'][i]['product']%>">Product:</label>
      <div class="display-flex">
        <select name="<%=invoice['products'][i]['product']%>">
          <option value="">Select a product</option>
          <% for (let j=0; j < productList.length; j++) { %>
          <option
            value="<%=productList[j]._id %>"
            <%= invoice.products[i] && invoice.products[i].product && productList[j]._id.equals(invoice.products[i].product._id) && 'selected' %>
          >
            <%= productList[j].name%>
          </option>
          <%} %>
        </select>
        <label for="<%=invoice['products'][i]['quantity']%>" hidden></label>
        <input
          id="quantity"
          name="<%=invoice['products'][i]['quantity']%>"
          type="number"
          placeholder="Enter quantity"
          value="<%= invoice['products'][i] && invoice['products'][i]['quantity']%>"
        />
      </div>
  <%} %>
  <input
    id="invoiceId"
    name="invoiceId"
    type="string"
    value="<%= invoiceId %>"
    hidden
  />
  <button class="btn btn-success" type="submit" value="Submit">Submit</button>
</form>
<p class="error-message"><%= errorMessage %></p>
<script>
  let invoiceDate = document.getElementById('invoice-date');
  if (invoiceDate.value === '') {
    invoiceDate.valueAsDate = new Date();
  }
</script>
